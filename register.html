<script src="config.js"></script>

<style>
	.overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(255, 255, 255, 0.8);
		display: flex;
		justify-content: center;
		align-items: center;
		z-index: 9999;
	}

	.spinner-border {
		width: 3rem;
		height: 3rem;
		border-width: 0.3em;
	}
</style>

<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Loading...</title> <!-- Placeholder title -->
	<link rel="stylesheet" href="css/style.css">
</head>

<body>

	<!-- Preloader -->
	<div class="overlay" id="loader">
		<div class="spinner-border text-primary" role="status">
			<span class="sr-only">Loading...</span>
		</div>
	</div>

	<!-- Header Container -->
	<header id="header-container"></header>

	<script type="module">
		import { createHeader } from './components/header.js';

		document.addEventListener('DOMContentLoaded', async function () {
			const preloader 			= document.getElementById('loader');
			const systemNameElement 	= document.querySelector('.system-name'); // Target the correct class
			if (systemNameElement) {
				systemNameElement.textContent = CONFIG.SYSTEM_NAME;
			}
			try {
				preloader.style.display = 'flex';

				await createHeader("Login", CONFIG.SYSTEM_NAME);

			} catch (error) {
				console.error("Error loading header:", error);
			} finally {
				preloader.style.display = 'none';
			}
		});
	</script>

	<div class="authincation d-flex flex-column flex-lg-row flex-column-fluid">
		<div class="login-aside text-center  d-flex flex-column flex-row-auto">
			<div class="d-flex flex-column-auto flex-column pt-lg-40 pt-15">
				<div class="text-center mb-lg-4 mb-2 pt-5 logo">
					<!-- <img src="images/logo-white.png" alt=""> -->
				</div>
				<h3 class="mb-2 text-white">Welcome back!</h3>
				<p class="mb-4 system-name"></p>
			</div>
			<div class="aside-image position-relative" style="background-image:url(images/background/pic-2.png);">
				<img class="img1 move-1" src="images/background/pic3.png" alt="">
				<img class="img2 move-2" src="images/background/pic4.png" alt="">
				<img class="img3 move-3" src="images/background/pic5.png" alt="">

			</div>
		</div>
		<div
			class="container flex-row-fluid d-flex flex-column justify-content-center position-relative overflow-hidden p-7 mx-auto">
			<div class="d-flex justify-content-center h-100 align-items-center">
				<div class="authincation-content style-2">
					<div class="row no-gutters">
						<div class="col-xl-12 tab-content">
							<div id="sign-up" class="auth-form tab-pane fade show active  form-validation">
								<form id="userForm" action="index.html">

									<div class="mb-3 row">
										<div class="col-md-6">
											<label for="name" class="form-label required">Name</label>
											<input type="text" class="form-control" id="name" required>
										</div>

										<div class="col-md-6">
											<label for="email" class="form-label required">Email</label>
											<input type="email" class="form-control" id="email" required>
										</div>
									</div>

									<div class="mb-3 row">
										<div class="col-md-6">
											<label for="username" class="form-label required">Username</label>
											<input type="text" class="form-control" id="username" required>
										</div>

										<div class="col-md-6">
											<label class="form-label required">Password</label>
											<input type="password" id="password" class="form-control" required>
											<span class="show-pass eye">
												<i class="fa fa-eye-slash"></i>
												<i class="fa fa-eye"></i>
											</span>
										</div>
									</div>

									<div class="mb-3 row">
										<div class="col-md-6">
											<label for="phone" class="form-label required">Phone</label>
											<input type="text" class="form-control" id="phone" required>
										</div>

										<div class="col-md-6">
											<label for="stateSelect" class="form-label required">State</label>
											<select class="form-control" id="stateSelect" required>
												<!-- States will be populated from values.js -->
											</select>
										</div>
									</div>

									<div class="mb-3">
										<label for="companyName" class="form-label required">Company Name</label>
										<input type="text" class="form-control" id="companyName" required>
									</div>

									<div class="mb-3">
										<label for="address" class="form-label">Address</label>
										<input type="text" class="form-control" id="address">
									</div>

									<div class="mb-3 row">
										<div class="col-md-6">
											<label for="tiktok" class="form-label">Tiktok</label>
											<input type="text" class="form-control" id="tiktok">
										</div>

										<div class="col-md-6">
											<label for="instagram" class="form-label">Instagram</label>
											<input type="text" class="form-control" id="instagram">
										</div>
									</div>

									<div class="mb-3 row">
										<div class="col-md-6">
											<label for="facebook" class="form-label">Facebook</label>
											<input type="text" class="form-control" id="facebook">
										</div>

										<div class="col-md-6">
											<label for="whatsapp" class="form-label">Whatsapp</label>
											<input type="text" class="form-control" id="whatsapp">
										</div>
									</div>

									<div class="mb-3">
										<label for="activationCode" class="form-label required">Activation Code</label>
										<input type="text" class="form-control" id="activationCode" required>
									</div>

									<button type="submit" class="btn btn-block btn-primary">Sign me up</button>
								</form>

								<div class="new-account mt-3 text-center">
									<p class="font-w500">Already have an account? <a class="text-primary"
											href="login.html">Login</a></p>
								</div>
							</div>
							<!-- <div class="d-flex align-items-center justify-content-center">
								<a href="javascript:void(0);" class="text-primary">Terms</a>
								<a href="javascript:void(0);" class="text-primary mx-5">Plans</a>
								<a href="javascript:void(0);" class="text-primary">Contact Us</a>
							</div> -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!--**********************************
        Scripts
    ***********************************-->
	<!-- Required vendors -->
	<script src="vendor/global/global.min.js"></script>
	<script src="vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
	<script src="js/custom.min.js"></script>
	<script src="js/dlabnav-init.js"></script>
	<!-- Bootstrap JS (requires Popper.js) -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>
<script>
	function populateStateDropdown() {
		const stateSelect = document.getElementById('stateSelect');
		stateSelect.innerHTML = '';
		const defaultOption = document.createElement('option');
		defaultOption.value = '';
		defaultOption.textContent = 'Select State';
		stateSelect.appendChild(defaultOption);

		CONFIG.STATES.forEach(state => {
			const option = document.createElement('option');
			option.value = state;
			option.textContent = state;
			stateSelect.appendChild(option);
		});
	}

	document.addEventListener('DOMContentLoaded', function () {
		populateStateDropdown();
	});
</script>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		const preloader = document.getElementById("loader");
		const form = document.getElementById("userForm");

		if (preloader && form) {
			form.addEventListener("submit", async function (event) {
				event.preventDefault();
				preloader.style.display = "flex";

				const data = {
					type_api: "register",
					name: document.getElementById("name").value,
					email: document.getElementById("email").value,
					username: document.getElementById("username").value,
					password: document.getElementById("password").value,
					phone: document.getElementById("phone").value,
					state: document.getElementById("stateSelect").value,
					company_name: document.getElementById("companyName").value,
					address: document.getElementById("address").value,
					tiktok: document.getElementById("tiktok").value,
					instagram: document.getElementById("instagram").value,
					facebook: document.getElementById("facebook").value,
					whatsapp: document.getElementById("whatsapp").value,
					activation_code: document.getElementById("activationCode").value,
					last_login: new Date().toISOString()
				};

				console.log(data);
				try {
					const response = await fetch(CONFIG.API_URL, {
						method: 'POST',
						headers: {
							"Content-Type": "text/plain", // âœ… Fix CORS issue
						},
						body: JSON.stringify(data)
					});

					const result = await response.json();

					if (result.success) {
						Swal.fire({
							title: "Success!",
							html: `<strong>Successfully created your account!</strong>`,
							icon: "success",
							confirmButtonText: "Okay",
						}).then(() => {
							window.location.href = 'login.html';
						});
					} else {
						Swal.fire({
							title: "Error",
							text: result.message || "Unknown error occurred.",
							icon: "error",
							confirmButtonText: "Okay",
						});
					}
				} catch (error) {
					Swal.fire({
						title: "Error",
						text: "Failed to register. Please try again.",
						icon: "error",
						confirmButtonText: "Okay",
					});
				} finally {
					document.getElementById("loader").style.display = "none";
				}
			});
		} else {
			console.error("Preloader or form not found in the DOM.");
		}
	});
</script>